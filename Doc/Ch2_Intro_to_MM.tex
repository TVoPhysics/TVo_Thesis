\chapter{The Fundamentals of Mode-Matching}\label{fund_mm}
	Theory section of modematching. Gaussian beams, define relevant quantities, Gouy Phase!
	
	In order to properly explain the effects of electromagnetic waves in the LIGO interferometers, it is useful to review the  
	
	References: [Kognelik and Li]
	
		\section{Gaussian Beam Optics}
		When dealing with length sensing degrees of freedoms such as section \ref{FP}, the simple plane wave approximation is sufficient in describing the dynamics, however, when trying to understand the misalignment and mode-mismatch signals, it is necessary to incorporate Gaussian beams and associated their higher order modes.

		
		Consider the famous Maxwell's equations in vacuum:
		
		\begin{equation}
		\label{18.1:1}
		\begin{aligned}
		 \nabla \times \mathbf{E} &=-\frac{\partial \mathbf{B}} {\partial t},&
		\\\nabla \cdot \mathbf{B} &=0&,
		\\\nabla \times \mathbf{B} &= \mu\ \mathbf{J} + \frac{1}{c^2} \frac{\partial \mathbf{E}} {\partial t}&
		\\
		\nabla \cdot \mathbf{E} &= \frac{\rho}{\epsilon}&
		\end{aligned}
		\end{equation}
		
		
		Concentrating on the electric field in vacuum, we arrive at the Helmholtz Equation
		
		\begin{equation}\label{Helmholtz}
		(\nabla^2 + k^2 ) \mathbf{U}(\mathbf{r},t) = 0
		\end{equation}
	
		
		where $k=\frac{2\pi\nu}{c}$ is the wave number and $\mathbf{U}(\mathbf{r},t)$ is the complex amplitude which can describe either the electric or magnetic fields.  
		
		It is possible to express the solution to equation  \ref{Helmholtz} as
		a plane wave with a modulated complex envelope
		\begin{equation}
		\mathbf{U}(\mathbf{r}) = \mathbf{A}(\mathbf{r}) e^{-ikz)}
		\end{equation}
		
		By imposing the constraints which force the envelope to vary slowly with respect to the z-axis within the distance of one wavelength $\lambda = 2\pi/k$,

		\begin{subequations}
		\begin{equation}\label{paraxiala}
		\bigg| { \partial^2 \mathbf{A} \over \partial z^2 } \bigg|  \ll  \bigg| { k {\frac{}\partial \mathbf{A}{\partial z} } } \bigg|
		\end{equation}
		\begin{equation}\label{paraxialb}
		\bigg| { \partial^2 \mathbf{A} \over \partial z^2 } \bigg|  \ll  \bigg| { k {\partial^2 \mathbf{A} \over \partial x^2} } \bigg|
		\end{equation}
		\begin{equation}\label{paraxialc}
		\bigg| { \partial^2 \mathbf{A} \over \partial z^2 } \bigg|  \ll  \bigg| { k {\partial^2 \mathbf{A} \over \partial y^2} } \bigg|
		\end{equation}
		\end{subequations}
		
		the partial differential equation which arises is called the Paraxial Helmholtz Equation:
		
		\begin{equation}\label{paraHelmholtz}
		\nabla_T^2 A(r) - i2k {\partial A(r) \over \partial z} = 0
		\end{equation}
		
		where $\nabla_T^2 = {\partial^2  \over \partial x^2} + {\partial^2  \over \partial y^2} $ is the transverse Laplacian.  A simple solution for equation \ref{paraHelmholtz} is the complex paraboloidal wave
		
		\begin{equation} \label{complexenvelope}
		A(\mathbf{r}) = \frac{A_0}{q(z)} e^{\frac{-ikr^2}{2q(z)}} , \quad q(z)=z+iz_0
		\end{equation}
		
		where $z_0$ is the Rayleigh range and is directly proportional to the square of the waist size.  In order to separate the amplitude and phase portions of the wave, it is useful to rewrite $q(z)$ as
		
		\begin{equation}\label{invq}
		\frac{1}{q(z)} = \frac{1}{R(z)} - i \frac{\lambda}{\pi W^2(z)}
		\end{equation} 
		
		Plugging equation \ref{invq} into \ref{complexenvelope} leads directly to the complex amplitude for a Gaussian Beam
		
		\begin{equation}
		U(r) = A_0 \frac{W_0}{W(z)} e^{-\frac{r^2}{W^2(z)}} e^{-ikz - ik \frac{r^2}{2R(z)} + i \phi(z)}
		\end{equation}
		
		where
		\begin{subequations}
		\begin{equation}
		W(z) = W_0 \sqrt{1 + \bigg( \frac{z}{z_0} \bigg)^2}
		\end{equation}
		\begin{equation}\label{ROC}
		R(z) = z \bigg[ 1 + \bigg( \frac{z}{z_0} \bigg)^2 \bigg]
		\end{equation}
		\begin{equation}
		\phi(z)= \text{tan}^{-1}\bigg(\frac{z}{z_0}\bigg)
		\end{equation}
		\begin{equation}
		W_0 = \sqrt{\frac{\lambda z_0}{\pi}}
		\end{equation}
		\end{subequations}


		\subsubsection{Gouy Phase}
		The Gouy phase is 
		- Gouy Phase + graph
		\subsubsection{Intensity}
		- Intensity and Power
		
		\subsubsection{Hermite-Gauss Modes}
		The fundamental Gaussian beam is not the only solution which can be used to solve equation \ref{paraHelmholtz}.  In fact, there exists a complete set of solutions that can solve the paraxial Helmholtz Equation in rectangular coordinates, which are referred to as the Hermite Gauss modes
		\begin{equation}\label{HG}
		\begin{aligned}
		&U_{mn}(x,y,z) = A_{mn}\bigg[ \frac{W_0}{W(z)} \bigg] \mathbb{G}_m\Bigg( \frac{\sqrt{2}x}{W(z)}  \Bigg) \mathbb{G}_n\Bigg( \frac{\sqrt{2}y}{W(z)} \Bigg)\\
		&\times \text{exp} \bigg\{ -ikz - \frac{ik(x^2+y^2)}{2R(z)} + i(m+n+1)\phi(z) \bigg\}
		\end{aligned}
		\end{equation}
		
		where,
		\begin{equation}
		\mathbb{G}_(u) = \mathbb{H}(u) \, \text{exp}(-u^2/2)
		\end{equation}
		
		and $ \mathbb{H}(u)$ are the well known Hermite polynomials.  It is important to mention that the Gouy phase of the complex amplitude is different than the fundamental Gaussian beam by a factor of $(m + n + 1)$. Also, the intensity distribution of these higher order modes are much different. Both of these facts will become extremely important in the following wavefront sensing discussion.
		
		It is useful to normalize the Hermite-Gauss modes with respect to the overall power, which are derived in Appendix[].
		
		How higher order modes show up in resonators, Gouy Phase, HOM spacing.
		
		\subsubsection{Laguerre Modes}
		Another complete set of alternative solutions to equation \ref{paraHelmholtz} exists which are called the Laguerre-Gauss modes
		
		\begin{equation}\label{LG}
		\begin{aligned}
		&V_{\mu\nu}(\rho,\theta,z) = A_{\mu\nu}\bigg[ \frac{W_0}{W(z)} \bigg] \mathbb{L}^{\mu}_{\nu} \Bigg( \frac{\sqrt{2}x}{W(z)}  \Bigg) \\
		&\times \text{exp} \bigg\{-ikz-\frac{ik\rho^2}{2R(z)} + i(\mu+2\nu+1)\phi(z) \bigg\}
		\end{aligned}
		\end{equation}
		
		where $\mathbb{L}^{\mu}_{\nu} \Bigg( \frac{\sqrt{2}x}{W(z)}  \Bigg)$ is the Laguerre polynomial function. Both equations \ref{HG} and \ref{LG} are able to fully describe any complex electromagnetic amplitude; and because they both form complete sets, there is a rotation which can map from one basis to the other [ref Bond and Biejergasern]
		
		\begin{equation}
		U^{LG}_{\mu \nu} (x,y,z) = \sum\limits_{k}^{N} i^k b(n,m,k) U^{HG}_{N-k,k} (x,y,z)
		\end{equation}
		where
		\begin{equation}
		b(n,m,k) = \sqrt{\bigg( \frac{(N-k)!k!}{2^N n!m!} \bigg)} \frac{1}{k!} \frac{\text{d}^k}{\text{d}t^k}[(1-t)^m (1+t)^m]\vert_{t=0}
		\end{equation}

		\subsection{Misalignment and Higher Order Modes}\label{Misalign}
		Morrison and Anderson derived a simplistic way of how small misalignments and mismodematched cavities can couple the fundamental Gaussian beam into various higher order modes.  This is done by taking a linear cavity and using its perfectly matched Gaussian beam as a reference, and then varying the input electric field with small perturbations and expanding in terms of the cavity modes.  As long as the mismatches are small, it is possible to consider only the first few terms of the expansion which have gained power from the fundamental mode.
		
		Consider the first three modes of equation \ref{HG} in one dimension and normalized to set the total optical power to unity (derived in Appendix[]):

		\begin{equation}
		\label{Gauss1D}
		\begin{aligned}
				U_{0}(r) & =	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  e^{-r^2/w^2(z)}		&
		\\		U_{1}(r) &	=	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  \frac{2r}{w(z)} \quad e^{-r^2/w^2(z)}&,
		\\	 	U_{2}(r) &	=	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  \frac{1}{\sqrt{2}} \bigg( \frac{4r^2}{w^2(z)} - 1 \bigg)   e^{-r^2/w^2(z)}
		\end{aligned}
		\end{equation}
				
		
		\subsubsection{Beam Axis Tilted}
		If the input beam into an optical cavity is tilted by an angle $\alpha$ with respect to the nominal cavity axis as shown in Figure [], the wave front of the input beam will have an extra phase propagation relative to the cavity that is approximately proportional to $e^{ik \alpha r}$.  By implementing the small angle approximation, which is valid if the misalignment is much smaller than the divergence angle of the fundamental mode $k \alpha r << 1$, the resultant input beam is
		
		\begin{equation}
		\Psi \approx U_{0}(r) e^{ik \alpha r} \approx U_{0}(r) ( 1 + ik \alpha r ) =  U_{0}(r) + \frac{ik \alpha w(z)}{\sqrt{2\pi}} U_{1}(r)
		\end{equation}
		
		Here the factor associated with the first higher order mode is complex, indicating there is a 90 degree phase difference between the fundamental and off axis mode. 
		\subsubsection{Beam Axis Displaced}
		If the input beam is displaced in the transverse direction by a quantity $\Delta r$, the resultant waveform will be
		
		\begin{equation}
		\begin{aligned}
			\Psi 	&=  		U_{0}(r + \Delta r	) 
			\\		&= 			\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  e^{-(r+\Delta r)^2/w^2(z)}
			\\		&= 			\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  e^{-(r^2 + 2r \Delta r  + \Delta r^2)/w^2(z)}
			\\		&\approx 	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  e^{-r^2/w^2(z)} e^{-2r \Delta r/w^2(z)}
			\\		&\approx 	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4}  e^{-r^2/w^2(z)} \bigg(1 - \frac{2r \Delta r}{w^2(z)} \bigg)
			\\		&=			\bigg( U_0(r) - \sqrt{\frac{2}{\pi}} \frac{\Delta r }{w(z)} U_1(r)	 \bigg)
		\end{aligned}
		\end{equation} 
		
		Similarly to a tilted input beam axis, the displaced beam axis couples power to the first higher order mode, however, the latter does not have a 90 degree phase difference previously seen in the former.  This point is of extreme importance when trying to discern between the two effects as shown in Section [].  Although comparing the two cases in Figure, one can already seen the difference between the wavefronts in the near field, $z<<z_R$, and the far field, $z>>z_R$.  
		
		In the near field, there is no phase difference due to a displaced beam, but there is one for a tilted beam.  Conversely, in the far field, there is no phase difference due to a tilted beam, but there is one from a displaced beam.  In order to implement a closed loop feedback system, the wavefront sensors discussed in Section \ref{WFS} will use this precise logic to extract an error signal.
		
		
		\subsection{Mode Mismatch and Higher Order Modes}\label{Modemismatch}
		
		
		\subsubsection{Waist Size Shifted}
		By considering the effect of evaluating the fundamental mode at the waist position, $z=0$, but changing the waist size by a small amount $\epsilon$, it is possible to see coupling into higher order modes by expanding to first order.	
		\begin{equation}
		\begin{aligned}
		\Psi 	&=  		U_{0} \big(r,w(z) = w_0/(1+\epsilon) \big) 
		\\		&= 			\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} \sqrt{1 + \epsilon} \quad e^{-r^2 (1+\epsilon)^2/w_0^2 }
		\\		&\approx 	\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} (1 + \epsilon /2) \quad e^{-r^2/w_0^2} \quad e^{-2r^2\epsilon/w_0^2} 
		\\		&\approx 	\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} (1 + \epsilon /2) \quad e^{-r^2/w_0^2} \quad (1-2r^2\epsilon/w_0^2)
		\\		&\approx 	\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} \bigg(1+ 2\epsilon\bigg(\frac{1}{4} - \frac{r^2}{w_0^2}\bigg) \bigg ) \quad e^{-r^2/w_0^2}	
		\\		&=			U_0(r) \, - \, \frac{\epsilon}{\sqrt{2}} \, U_2(r)
		\end{aligned}
		\end{equation}
		Changing the waist size by a small amount will couple the fundamental mode to the in-phase second order Hermite Gauss mode.
		
		\subsubsection{Waist Position Shifted}
		To repeat the process from above with a waist position shift, it is useful to start with a more general equation that includes the phase that is gained from including the radius of curvature,
		
		\begin{equation}\label{EFieldwPhase}
		\Psi = 	\bigg( \frac{2}{\pi w^2(z)} \bigg)^{1/4} \quad e^{-r^2/w^2(z)} \quad e^{-ikr^2/2R(z)}
		\end{equation}
		where $R(z)$ is from equation \ref{ROC}.  It is also useful to approximate the shift in waist position along the longitudinal axis is small compared to the Rayleigh range of the beam, $\Delta z << z_0$, which leaves the waist size approximately the same and the radius of curvature inversely proportional to the shift. 
		
		\begin{subequations}
		\begin{align}
		\begin{split}
			w^2(\Delta z)	&= 	w^2_0 \bigg[1 + \bigg(\frac{\Delta z}{z_0}  \bigg)^2 \bigg]  \approx	w^2_0
		\end{split}\\
		\begin{split}
			R(\Delta z) 	&=	\Delta z \bigg(1 + \bigg(\frac{z_0}{\Delta z}\bigg)^2\bigg) \approx	\frac{z_0^2}{\Delta z}
		\end{split}
		\end{align}
		\end{subequations}

		Plugging the equations above into \ref{EFieldwPhase},
		
		\begin{equation}
		\begin{aligned}
		\Psi 	&\approx	\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} \quad e^{-r^2/w_0^2} \quad e^{-ikr^2 \Delta z /2 z_0^2}
		\\		&\approx	\bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} \quad e^{-r^2/w_0^2} \quad \bigg( 1-\frac{ikr^2 \Delta z}{2 z_0^2}  \bigg)
		\\		&=			U_0(r) - \bigg( \frac{2}{\pi w_0^2} \bigg)^{1/4} e^{-r^2/w_0^2} \quad \frac{ikr^2 \Delta z}{2 z_0^2}
		\\		&=			U_0(r) - i \frac{\Delta z}{2k w_0^2} \bigg( 4U_2(r) + U_0(r) \bigg)
		\end{aligned}
		\end{equation}
		
		The equations above show that a fundamental Gaussian mode that is shifted in waist position will couple power to the second order Hermite Gauss mode.  Although changes in the waist size or position couple power to the same mode, they differ by a 90 degrees in phase as denoted by the extra factor of $i$ in the coupling coefficient.  By recognizing the two effects are in different quadrature phases will allow a user to design a system to distinguish between the different types of physical couplings, this is shown in Section \ref{WFS}.
		
		 In order to be physically valid one would need to consider the full two dimensional space so that the equation would encapsulate the full transverse mode, however, the x and y components would follow the exact same derivation. On that point, it is important to note that only the mode mismatch couplings from either a varying waist position or size has higher order modes that are circularly symmetric.
		
		
%%%%%%%%%%%%%%%%
		\section{Wavefront Sensing}\label{WFS}
		Heterodyne detection via modal decomposition of the full electric field allows the use of wavefront sensors to extract an error signal from the optical system.  Hefetz et.al Ref[Sigg and Nergis] created a formalism to describe the use of wavefront sensors by creating frequency sidebands which accumulate a different Gouy phase than the electric field at the carrier frequency when passed through the optical system.  By observing the demodulated signal of the intensity, it is possible to obtain a linear signal that corresponds to a physical misalignment or mode mismatch.
		
		Fundamentally, the purpose of wavefront sensing is to detect the content of higher order modes due to physical disturbances of the optical cavity (ie. mode mismatch or misalignment).  In other words, it is examining the difference of basis sets between the incoming eigenmodes and the cavity eigenmodes.
		
		Consider a general equation for an electric field which is a linear combination of all higher order modes of the complex amplitude
		\begin{equation}
		E(x,y,z) = \sum\limits_{m,n}^{\infty} a_{mn} U_{mn}(x,y,z)
		\end{equation}
		
		where $ U_{mn}(x,y,z)$ are the eigenmodes described in equation \ref{HG} (or \ref{LG}) and $a_{mn}$ is the complex amplitude.  It is also convenient in the following analysis to use vectors when describing the composition of the electric fields.
		
		\begin{equation}\label{EVector}
		\ket{E(x,y,z)} = \begin{pmatrix} E_{00} 
		\\ E_{01}
		\\E_{10}
		\\E_{20}
		\\E_{02}
		\end{pmatrix}
		\end{equation}

		When creating a theory that involves laser beams, it is useful to define operators that are important in describing physical situations.  For example, laser beams propagate through space and pick up phase according to equation \ref{HG} which can be represented by the spatial propagation operator,
		
		\begin{equation}
		\hat{P}_{mn,kl} = \delta_{mn} \delta_{kl} \quad \text{exp}[-ik(z_2 - z_1)] 
		\\ \text{exp}[i(m+n+1)\phi(z)]
		\end{equation}

		However, it is useful to compare how the fundamental Gaussian mode propagates compared to the higher order modes,

		\begin{equation} \label{GouyPhaseMatrix}
		\hat{\eta}_{\mu \nu} = 
		\begin{pmatrix}
		e^{i\phi}	&0			&0			& 0 			& 0
		\\ 0		&e^{2i\phi}	&0			& 0				& 0
		\\ 0		&0			&e^{2i\phi}	& 0				& 0
		\\ 0		&0			&0			& e^{3i\phi}	& 0
		\\ 0		&0			&0			& 0				& e^{3i\phi}
		\end{pmatrix}
		\end{equation}

		From the above diagonal elements, it is clear that the higher order modes have an extra phase compared to the fundamental 00 mode, this effect will be extremely important on how an error signal can be derived from the optical system.
		
		\begin{equation}
		\ket{E(x,y,z_2)} = \hat{M}(x,y,z_1,z_2)	\ket{E(x,y,z_1)}
		\end{equation}
		
		where $\hat{M}(x,y,z_1,z_2)$ is the misalignment operator.  Since we are using the paraxial approximation, the z-components of the misalignment operator are small so we can approximate $\hat{M}_(x,y,z_1,z_2) \approx \hat{M}_(x,y)$ and the expectation value is
		
		\begin{equation}
		M_{mn,kl}=  \bra{U_{mn}(x,y,z_1)} M(x,y) \ket{U_{kl}(x,y,z_2)}
		\end{equation}

		where the product is an integral over the transverse space $\int \!\!\! \int_{D(x,y)} \text{d}x \text{d}y$
		

		\begin{equation} \label{misalign_matrix}
		\hat{\Theta}_{\mu \nu} = 
		\begin{pmatrix}
		   1			&2i\theta_x		&2i\theta_y		& 0 & 0
		\\ 2i\theta_x	&1				&0				& 0	& 0
		\\ 2i\theta_y	&0				&1				& 0	& 0
		\\ 0			&0				&0				& 1	& 0
		\\ 0			&0				&0				& 0	& 1
		\end{pmatrix}
		\end{equation}

		\begin{equation} \label{mistrans_matrix}
		\hat{\mathbb{D}}_{\mu \nu} = 
		\begin{pmatrix}
			1					&\alpha_x/\omega_{0}	&\alpha_y/\omega_{0}	& 0 & 0
		\\ \alpha_x/\omega_{0}	&1						&0						& 0 & 0
		\\ \alpha_y/\omega_{0}	&0						&1						& 0	& 0
		\\ 0					&0						&0						& 1	& 0
		\\ 0					&0						&0						& 0 & 1 
		\end{pmatrix}
		\end{equation}
		
		
		\begin{equation} \label{waistloc_matrix}
		\hat{\mathbb{Z}}_{\mu \nu} = 
		\begin{pmatrix}
		1				&0		&0		&\Delta z_x 	&\Delta z_y  
		\\ 0			&1		&0		&0 				&0
		\\ 0			&0		&1		&0 				&0
		\\ \Delta z_x	&0		&0		&1 				&0
		\\ \Delta z_y	&0		&0		&0				&1 
		\end{pmatrix}
		\end{equation}
		
		where $\Delta z_{(x,y)} =  \frac{i}{\sqrt{2}} \frac{\lambda b}{2\pi\omega_{0}} $
		
		
		\begin{equation} \label{waistsize_matrix}
		\hat{\mathbb{Z}}_{0, \mu \nu} = 
		\begin{pmatrix}
		1					&0		&0		&\Delta z_{0,x} 	&\Delta z_{0,y} 
		\\ 0				&1		&0		&0 					&0
		\\ 0				&0		&1		&0 					&0
		\\ \Delta z_{0,x} 	&0		&0		&1 					&0
		\\ \Delta z_{0,y} 	&0		&0		&0					&1 
		\end{pmatrix}
		\end{equation}

		where $\Delta z_{0,(x,y)} =   \frac{1}{\sqrt{2}} \frac{\omega'-\omega_{0}}{\omega_{0}} $

		Figure: Beat frequency between two modes.
		
		
		\subsubsection{Example: Fabry Perot Cavity}
		
		
		\subsubsection{Example: Simple Michaelson}
		


		\section{Effects of Mode-matching on Squeezing}
		Still not clear to me.
		In the most simple sense, a loss is akin to coupling quantum vacuum into a squeezed state.
		References: [Miao, Sheon, Kimble, Dwyer]
	
	